{"version":3,"sources":["../src/ap2.ts","../src/utils/x402.ts","../src/utils/axllm.ts","../src/config.ts","../src/utils/utils.ts","../src/erc8004.ts","../src/payments.ts","../src/pricing.ts","../src/paywall.ts","../src/manifest.ts","../src/app.ts"],"names":["DEFAULT_PROVIDER","DEFAULT_MODEL","result","wrapFetchWithPayment","facilitator","coinbaseFacilitator"],"mappings":"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","file":"index.js","sourcesContent":["// AP2 (Agent Payments Protocol) typings and constants.\n// These mirror the published PYDantic models so TypeScript agents can share\n// the same shapes when constructing mandates or AgentCard extensions.\n\nexport const CONTACT_ADDRESS_DATA_KEY =\n  \"contact_picker.ContactAddress\" as const;\n\nexport type ContactAddress = {\n  city?: string | null;\n  country?: string | null;\n  dependent_locality?: string | null;\n  organization?: string | null;\n  phone_number?: string | null;\n  postal_code?: string | null;\n  recipient?: string | null;\n  region?: string | null;\n  sorting_code?: string | null;\n  address_line?: string[] | null;\n};\n\nexport const PAYMENT_METHOD_DATA_KEY =\n  \"payment_request.PaymentMethodData\" as const;\n\nexport type PaymentCurrencyAmount = {\n  currency: string;\n  value: number;\n};\n\nexport type PaymentItem = {\n  label: string;\n  amount: PaymentCurrencyAmount;\n  pending?: boolean | null;\n  refund_period?: number;\n};\n\nexport type PaymentShippingOption = {\n  id: string;\n  label: string;\n  amount: PaymentCurrencyAmount;\n  selected?: boolean | null;\n};\n\nexport type PaymentOptions = {\n  request_payer_name?: boolean | null;\n  request_payer_email?: boolean | null;\n  request_payer_phone?: boolean | null;\n  request_shipping?: boolean | null;\n  shipping_type?: \"shipping\" | \"delivery\" | \"pickup\" | null;\n};\n\nexport type PaymentMethodData = {\n  supported_methods: string;\n  data?: Record<string, unknown>;\n};\n\nexport type PaymentDetailsModifier = {\n  supported_methods: string;\n  total?: PaymentItem;\n  additional_display_items?: PaymentItem[];\n  data?: unknown;\n};\n\nexport type PaymentDetailsInit = {\n  id: string;\n  display_items: PaymentItem[];\n  shipping_options?: PaymentShippingOption[];\n  modifiers?: PaymentDetailsModifier[];\n  total: PaymentItem;\n};\n\nexport type PaymentRequest = {\n  method_data: PaymentMethodData[];\n  details: PaymentDetailsInit;\n  options?: PaymentOptions;\n  shipping_address?: ContactAddress;\n};\n\nexport type PaymentResponse = {\n  request_id: string;\n  method_name: string;\n  details?: Record<string, unknown>;\n  shipping_address?: ContactAddress;\n  shipping_option?: PaymentShippingOption;\n  payer_name?: string | null;\n  payer_email?: string | null;\n  payer_phone?: string | null;\n};\n\nexport const INTENT_MANDATE_DATA_KEY = \"ap2.mandates.IntentMandate\" as const;\nexport const CART_MANDATE_DATA_KEY = \"ap2.mandates.CartMandate\" as const;\nexport const PAYMENT_MANDATE_DATA_KEY = \"ap2.mandates.PaymentMandate\" as const;\n\nexport type IntentMandate = {\n  user_cart_confirmation_required: boolean;\n  natural_language_description: string;\n  merchants?: string[] | null;\n  skus?: string[] | null;\n  requires_refundability?: boolean | null;\n  intent_expiry: string;\n};\n\nexport type CartContents = {\n  id: string;\n  user_cart_confirmation_required: boolean;\n  payment_request: PaymentRequest;\n  cart_expiry: string;\n  merchant_name: string;\n};\n\nexport type CartMandate = {\n  contents: CartContents;\n  merchant_authorization?: string | null;\n};\n\nexport type PaymentMandateContents = {\n  payment_mandate_id: string;\n  payment_details_id: string;\n  payment_details_total: PaymentItem;\n  payment_response: PaymentResponse;\n  merchant_agent: string;\n  timestamp: string;\n};\n\nexport type PaymentMandate = {\n  payment_mandate_contents: PaymentMandateContents;\n  user_authorization?: string | null;\n};\n\nexport const AP2_EXTENSION_URI =\n  \"https://github.com/google-agentic-commerce/ap2/tree/v0.1\" as const;\n\nexport type AP2Role =\n  | \"merchant\"\n  | \"shopper\"\n  | \"credentials-provider\"\n  | \"payment-processor\";\n\nexport type AP2ExtensionParams = {\n  roles: [AP2Role, ...AP2Role[]];\n  [key: string]: unknown;\n};\n\nexport type AP2ExtensionDescriptor = {\n  uri: typeof AP2_EXTENSION_URI;\n  description?: string;\n  required?: boolean;\n  params: AP2ExtensionParams;\n};\n","import { ai } from \"@ax-llm/ax\";\nimport { privateKeyToAccount } from \"viem/accounts\";\nimport { wrapFetchWithPayment, type Hex } from \"x402-fetch\";\n\nconst DEFAULT_MODEL = \"gpt-5\";\nconst DEFAULT_PROVIDER = \"openai\";\nconst DEFAULT_API_URL = \"http://localhost:3030/v1\";\n\ntype WrappedFetch = typeof fetch & {\n  preconnect?: () => Promise<void>;\n};\n\nexport type X402Account = Parameters<typeof wrapFetchWithPayment>[1];\n\nexport type CreateX402FetchOptions = {\n  account: X402Account;\n  fetchImpl?: typeof fetch;\n};\n\nexport const createX402Fetch = ({\n  account,\n  fetchImpl,\n}: CreateX402FetchOptions): WrappedFetch => {\n  if (!account) {\n    throw new Error(\"[agent-kit] createX402Fetch requires an account\");\n  }\n  const paymentFetch = wrapFetchWithPayment(\n    (fetchImpl ?? fetch) as Parameters<typeof wrapFetchWithPayment>[0],\n    account\n  ) as WrappedFetch;\n\n  return Object.assign(\n    (input: Parameters<typeof fetch>[0], init?: Parameters<typeof fetch>[1]) =>\n      paymentFetch(input, init ?? {}),\n    {\n      preconnect: paymentFetch.preconnect ?? (async () => {}),\n    }\n  );\n};\n\nexport const accountFromPrivateKey = (privateKey: Hex): X402Account => {\n  if (!privateKey || privateKey.trim().length === 0) {\n    throw new Error(\n      \"[agent-kit] accountFromPrivateKey requires a non-empty private key\"\n    );\n  }\n  return privateKeyToAccount(privateKey) as X402Account;\n};\n\ntype AiFactoryArgs = Parameters<typeof ai>[0];\ntype AiFactoryConfig = NonNullable<AiFactoryArgs[\"config\"]>;\ntype AiFactoryOptions = NonNullable<AiFactoryArgs[\"options\"]>;\n\nexport type CreateX402LLMOptions = {\n  account?: X402Account;\n  privateKey?: Hex;\n  fetch?: WrappedFetch;\n  fetchImpl?: typeof fetch;\n  model?: string;\n  ai?:\n    | (Record<string, unknown> & {\n        options?: Partial<AiFactoryOptions>;\n        config?: Partial<AiFactoryConfig>;\n      })\n    | undefined;\n};\n\nexport const createX402LLM = (\n  options: CreateX402LLMOptions = {}\n): ReturnType<typeof ai> => {\n  const account =\n    options.account ??\n    (options.privateKey\n      ? accountFromPrivateKey(options.privateKey)\n      : undefined);\n\n  if (!account) {\n    throw new Error(\n      \"[agent-kit] createX402LLM requires either an account or a private key\"\n    );\n  }\n\n  const paymentFetch =\n    options.fetch ?? createX402Fetch({ account, fetchImpl: options.fetchImpl });\n\n  const aiOverrides = options.ai ?? {};\n  const {\n    config: configOverridesRaw,\n    options: optionOverridesRaw,\n    apiKey: apiKeyOverrideRaw,\n    apiURL: apiUrlOverrideRaw,\n    name: nameOverrideRaw,\n    ...restAiProps\n  } = aiOverrides;\n\n  const configOverrides =\n    configOverridesRaw && typeof configOverridesRaw === \"object\"\n      ? (configOverridesRaw as Partial<AiFactoryConfig>)\n      : undefined;\n  const optionOverrides =\n    optionOverridesRaw && typeof optionOverridesRaw === \"object\"\n      ? (optionOverridesRaw as Partial<AiFactoryOptions>)\n      : undefined;\n  const explicitApiKey =\n    typeof apiKeyOverrideRaw === \"string\" && apiKeyOverrideRaw.trim().length > 0\n      ? apiKeyOverrideRaw\n      : undefined;\n  const nameOverride =\n    typeof nameOverrideRaw === \"string\" && nameOverrideRaw.trim().length > 0\n      ? nameOverrideRaw\n      : undefined;\n  const apiUrlOverride =\n    typeof apiUrlOverrideRaw === \"string\" && apiUrlOverrideRaw.trim().length > 0\n      ? apiUrlOverrideRaw\n      : undefined;\n\n  const apiKey = (explicitApiKey ?? process.env.OPENAI_API_KEY) as\n    | string\n    | undefined;\n\n  if (!apiKey) {\n    throw new Error(\n      \"[agent-kit] createX402LLM requires an OpenAI API key (set options.ai.apiKey or OPENAI_API_KEY)\"\n    );\n  }\n\n  const baseConfig: AiFactoryConfig = {\n    stream: true,\n    model: options.model ?? DEFAULT_MODEL,\n  };\n\n  const finalConfig = {\n    ...baseConfig,\n    ...(configOverrides ?? {}),\n  } as AiFactoryConfig;\n\n  const finalOptions = {\n    ...(optionOverrides ?? {}),\n    fetch: paymentFetch,\n  } as AiFactoryOptions;\n\n  const aiArgs = {\n    ...restAiProps,\n    name: nameOverride ?? DEFAULT_PROVIDER,\n    apiKey,\n    apiURL: apiUrlOverride ?? DEFAULT_API_URL,\n    config: finalConfig,\n    options: finalOptions,\n  } as AiFactoryArgs;\n\n  return ai(aiArgs);\n};\n\nexport const x402LLM = ({\n  privateKey = process.env.PRIVATE_KEY as Hex,\n  model = DEFAULT_MODEL,\n  apiURL = DEFAULT_API_URL,\n}: {\n  privateKey: Hex;\n  model?: string;\n  apiURL?: string;\n}) =>\n  createX402LLM({\n    privateKey,\n    model,\n    ai: { apiURL },\n  });\n","import { createX402LLM, type CreateX402LLMOptions } from \"./x402\";\nimport type { Hex } from \"viem\";\n\nexport type AxLLMClientOptions = {\n  provider?: string;\n  model?: string;\n  apiKey?: string;\n  temperature?: number;\n  debug?: boolean;\n  env?: Record<string, string | undefined>;\n  client?: ReturnType<typeof createX402LLM>;\n  clientFactory?: () => ReturnType<typeof createX402LLM> | null;\n  x402?: CreateX402LLMOptions;\n  logger?: {\n    warn?: (message: string, error?: unknown) => void;\n  };\n};\n\nexport type AxLLMClient = {\n  ax: ReturnType<typeof createX402LLM> | null;\n  isConfigured(): boolean;\n};\n\nconst DEFAULT_PROVIDER = \"openai\";\nconst DEFAULT_MODEL = \"gpt-5\";\n\nexport function createAxLLMClient(\n  options: AxLLMClientOptions = {}\n): AxLLMClient {\n  const resolved = resolveOptions(options);\n  const logger = options.logger;\n\n  const axInstance = (() => {\n    if (options.client) return options.client;\n\n    const fromFactory = options.clientFactory?.();\n    if (fromFactory) return fromFactory;\n\n    try {\n      return createX402LLM(buildCreateOptions(resolved, options.x402));\n    } catch (error) {\n      logger?.warn?.(\n        `[agent-kit] failed to initialise Ax LLM client: ${\n          (error as Error).message\n        }`,\n        error\n      );\n      return null;\n    }\n  })();\n\n  return {\n    ax: axInstance,\n    isConfigured() {\n      return Boolean(axInstance);\n    },\n  };\n}\n\nfunction resolveOptions(options: AxLLMClientOptions) {\n  const env = readEnv(options.env);\n\n  const provider =\n    options.provider ??\n    env.AX_PROVIDER ??\n    env.AXLLM_PROVIDER ??\n    env.OPENAI_PROVIDER ??\n    DEFAULT_PROVIDER;\n\n  const model =\n    options.model ??\n    env.AX_MODEL ??\n    env.AXLLM_MODEL ??\n    env.OPENAI_MODEL ??\n    DEFAULT_MODEL;\n\n  const apiKey = options.apiKey ?? env.OPENAI_API_KEY;\n\n  const temperature =\n    options.temperature ??\n    parseNumber(\n      env.AX_TEMPERATURE ?? env.AXLLM_TEMPERATURE ?? env.OPENAI_TEMPERATURE\n    );\n\n  const debug =\n    options.debug ?? parseBoolean(env.AX_DEBUG ?? env.AXLLM_DEBUG) ?? false;\n\n  return { provider, model, apiKey, temperature, debug };\n}\n\nfunction buildCreateOptions(\n  resolved: ReturnType<typeof resolveOptions>,\n  overrides: CreateX402LLMOptions | undefined\n): CreateX402LLMOptions {\n  const x402 = overrides ? { ...overrides } : {};\n  const aiOverrides = overrides?.ai ? { ...overrides.ai } : {};\n  const aiConfigOverrides =\n    aiOverrides.config && typeof aiOverrides.config === \"object\"\n      ? { ...aiOverrides.config }\n      : undefined;\n  const aiOptionOverrides =\n    aiOverrides.options && typeof aiOverrides.options === \"object\"\n      ? { ...aiOverrides.options }\n      : undefined;\n\n  const finalTemperature =\n    aiConfigOverrides && \"temperature\" in aiConfigOverrides\n      ? aiConfigOverrides.temperature\n      : resolved.temperature;\n\n  const finalConfig = {\n    stream: true,\n    model: aiConfigOverrides?.model ?? x402.model ?? resolved.model,\n    ...(aiConfigOverrides ?? {}),\n    ...(finalTemperature !== undefined\n      ? { temperature: finalTemperature }\n      : {}),\n  };\n\n  const finalOptions = {\n    ...(aiOptionOverrides ?? {}),\n    ...(resolved.debug ? { debug: resolved.debug } : {}),\n  };\n\n  const apiKey =\n    aiOverrides.apiKey ??\n    resolved.apiKey ??\n    (typeof process !== \"undefined\" ? process.env.OPENAI_API_KEY : undefined);\n\n  if (!apiKey) {\n    throw new Error(\n      \"[agent-kit] createAxLLMClient requires an OpenAI API key (set apiKey or OPENAI_API_KEY)\"\n    );\n  }\n\n  const name = aiOverrides.name ?? resolved.provider;\n\n  const finalAi = {\n    ...aiOverrides,\n    name,\n    apiKey,\n    config: finalConfig,\n    options: finalOptions,\n  } as NonNullable<CreateX402LLMOptions[\"ai\"]>;\n\n  const createOptions: CreateX402LLMOptions = {\n    ...x402,\n    model: x402.model ?? resolved.model,\n    ai: finalAi,\n  };\n\n  if (!createOptions.account && !createOptions.privateKey) {\n    const envPrivateKey =\n      typeof process !== \"undefined\"\n        ? (process.env.PRIVATE_KEY as Hex | undefined)\n        : undefined;\n    if (envPrivateKey) {\n      createOptions.privateKey = envPrivateKey;\n    }\n  }\n\n  return createOptions;\n}\n\nfunction readEnv(\n  env: Record<string, string | undefined> | undefined\n): Record<string, string | undefined> {\n  if (env) return env;\n  if (typeof process !== \"undefined\" && process?.env) {\n    return process.env as Record<string, string | undefined>;\n  }\n  return {};\n}\n\nfunction parseBoolean(value: string | undefined): boolean | undefined {\n  if (value === undefined) return undefined;\n  if (value.trim() === \"\") return undefined;\n  return [\"1\", \"true\", \"yes\", \"on\"].includes(value.toLowerCase());\n}\n\nfunction parseNumber(value: string | undefined): number | undefined {\n  if (value === undefined) return undefined;\n  const numeric = Number.parseFloat(value);\n  return Number.isFinite(numeric) ? numeric : undefined;\n}\n","import type { Network, Resource, SolanaAddress } from \"x402-hono\";\n\nexport type PaymentDefaultsConfig = {\n  facilitatorUrl?: Resource;\n  payTo?: `0x${string}` | SolanaAddress;\n  network?: Network;\n  defaultPrice?: string;\n};\n\nexport type WalletConfig = {\n  apiBaseUrl?: string;\n  maxPaymentBaseUnits?: bigint;\n  maxPaymentUsd?: number;\n};\n\nexport type AgentKitConfig = {\n  payments?: PaymentDefaultsConfig;\n  wallet?: WalletConfig;\n};\n\nexport type ResolvedAgentKitConfig = {\n  payments: {\n    facilitatorUrl: Resource;\n    payTo: `0x${string}` | SolanaAddress;\n    network: Network;\n    defaultPrice?: string;\n  };\n  wallet: {\n    apiBaseUrl: string;\n    maxPaymentBaseUnits?: bigint;\n    maxPaymentUsd?: number;\n  };\n};\n\nconst DEFAULT_FACILITATOR_URL =\n  \"https://facilitator.daydreams.systems\" as Resource;\nconst DEFAULT_PAYMENT_WALLET_ADDRESS =\n  \"0xb308ed39d67D0d4BAe5BC2FAEF60c66BBb6AE429\";\nconst DEFAULT_NETWORK = \"base-sepolia\" as Network;\nconst DEFAULT_AGENT_API_BASE_URL = \"http://localhost:8787\";\n\nconst defaultConfig: ResolvedAgentKitConfig = {\n  payments: {\n    facilitatorUrl: DEFAULT_FACILITATOR_URL,\n    payTo: DEFAULT_PAYMENT_WALLET_ADDRESS,\n    network: DEFAULT_NETWORK,\n    defaultPrice: undefined,\n  },\n  wallet: {\n    apiBaseUrl: DEFAULT_AGENT_API_BASE_URL,\n    maxPaymentBaseUnits: undefined,\n    maxPaymentUsd: undefined,\n  },\n};\n\nfunction parseBigIntEnv(value: string | undefined): bigint | undefined {\n  if (!value) return undefined;\n  try {\n    const parsed = BigInt(value);\n    return parsed > 0n ? parsed : undefined;\n  } catch {\n    return undefined;\n  }\n}\n\nfunction parseNumberEnv(value: string | undefined): number | undefined {\n  if (!value) return undefined;\n  const numeric = Number(value);\n  if (!Number.isFinite(numeric) || numeric <= 0) return undefined;\n  return numeric;\n}\n\nconst environmentConfig: AgentKitConfig = {\n  payments: {\n    facilitatorUrl: process.env.FACILITATOR_URL as Resource | undefined,\n    payTo: process.env.ADDRESS as `0x${string}` | SolanaAddress | undefined,\n    network: process.env.NETWORK as Network | undefined,\n    defaultPrice: process.env.DEFAULT_PRICE ?? undefined,\n  },\n  wallet: {\n    apiBaseUrl:\n      process.env.LUCID_API_URL ?? process.env.VITE_API_URL ?? undefined,\n    maxPaymentBaseUnits: parseBigIntEnv(\n      process.env.AGENT_WALLET_MAX_PAYMENT_BASE_UNITS\n    ),\n    maxPaymentUsd: parseNumberEnv(process.env.AGENT_WALLET_MAX_PAYMENT_USDC),\n  },\n};\n\nlet runtimeOverrides: AgentKitConfig = {};\n\nfunction assignDefined<T extends Record<string, any>>(\n  target: T,\n  source: Partial<T> | undefined\n) {\n  if (!source) return;\n  for (const [key, value] of Object.entries(source)) {\n    if (value !== undefined) {\n      target[key as keyof T] = value as T[keyof T];\n    }\n  }\n}\n\nfunction applyOverrides(\n  base: ResolvedAgentKitConfig,\n  overrides?: AgentKitConfig\n): ResolvedAgentKitConfig {\n  if (!overrides) return base;\n  const next: ResolvedAgentKitConfig = {\n    payments: { ...base.payments },\n    wallet: { ...base.wallet },\n  };\n  assignDefined(next.payments, overrides.payments);\n  assignDefined(next.wallet, overrides.wallet);\n  return next;\n}\n\nfunction mergeRuntimeOverrides(\n  current: AgentKitConfig,\n  overrides: AgentKitConfig\n): AgentKitConfig {\n  const merged: AgentKitConfig = {\n    payments: { ...(current.payments ?? {}) },\n    wallet: { ...(current.wallet ?? {}) },\n  };\n  assignDefined(merged.payments!, overrides.payments);\n  assignDefined(merged.wallet!, overrides.wallet);\n  if (merged.payments && Object.keys(merged.payments).length === 0) {\n    delete merged.payments;\n  }\n  if (merged.wallet && Object.keys(merged.wallet).length === 0) {\n    delete merged.wallet;\n  }\n  return merged;\n}\n\nexport function configureAgentKit(overrides: AgentKitConfig) {\n  runtimeOverrides = mergeRuntimeOverrides(runtimeOverrides, overrides);\n}\n\nexport function resetAgentKitConfigForTesting() {\n  runtimeOverrides = {};\n}\n\nexport function getAgentKitConfig(): ResolvedAgentKitConfig {\n  const withEnv = applyOverrides(defaultConfig, environmentConfig);\n  return applyOverrides(withEnv, runtimeOverrides);\n}\n\nexport const defaults = {\n  facilitatorUrl: DEFAULT_FACILITATOR_URL,\n  payTo: DEFAULT_PAYMENT_WALLET_ADDRESS,\n  network: DEFAULT_NETWORK,\n  agentApiBaseUrl: DEFAULT_AGENT_API_BASE_URL,\n} as const;\n","import { z } from \"zod\";\nimport type { PaymentsConfig } from \"../types\";\nimport { getAgentKitConfig } from \"../config\";\n\nexport type Hex = `0x${string}`;\n\nexport const ZERO_ADDRESS: Hex = \"0x0000000000000000000000000000000000000000\";\n\nexport function normalizeDomain(domain: string): string {\n  return domain?.trim?.().toLowerCase?.() ?? \"\";\n}\n\nexport function normalizeAddress(value: string | null | undefined): Hex {\n  if (!value) {\n    throw new Error(\"invalid hex address\");\n  }\n  const trimmed = value.trim();\n  if (!/^0x[0-9a-fA-F]{40}$/.test(trimmed)) {\n    throw new Error(`invalid hex address: ${value}`);\n  }\n  return trimmed.toLowerCase() as Hex;\n}\n\nexport function sanitizeAddress(value: string | null | undefined): Hex {\n  if (!value) return ZERO_ADDRESS;\n  try {\n    return normalizeAddress(value);\n  } catch {\n    return ZERO_ADDRESS;\n  }\n}\n\nexport function toJsonSchemaOrUndefined(s?: z.ZodTypeAny) {\n  if (!s) return undefined;\n  try {\n    return z.toJSONSchema(s);\n  } catch {\n    return undefined;\n  }\n}\n\nexport function paymentsFromEnv(params?: {\n  defaultPrice?: string;\n}): PaymentsConfig {\n  const { payments } = getAgentKitConfig();\n  return {\n    payTo: payments.payTo,\n    facilitatorUrl: payments.facilitatorUrl,\n    network: payments.network,\n    defaultPrice: params?.defaultPrice ?? payments.defaultPrice,\n  };\n}\n","import type { TrustConfig, RegistrationEntry } from \"./types\";\nimport { ZERO_ADDRESS, normalizeAddress, normalizeDomain } from \"./utils\";\nimport type { Hex } from \"./utils\";\nexport type { Hex } from \"./utils\";\n\nexport type IdentityRegistryClientOptions<\n  PublicClient extends PublicClientLike,\n  WalletClient extends WalletClientLike | undefined = undefined,\n> = {\n  address: Hex;\n  chainId?: number;\n  publicClient: PublicClient;\n  walletClient?: WalletClient;\n  namespace?: string;\n};\n\nexport type IdentityRecord = {\n  agentId: bigint;\n  agentDomain: string;\n  agentAddress: Hex;\n};\n\nexport type IdentityRegistryClient = {\n  readonly address: Hex;\n  readonly chainId?: number;\n  get(agentId: bigint | number | string): Promise<IdentityRecord | null>;\n  resolveByDomain(domain: string): Promise<IdentityRecord | null>;\n  resolveByAddress(address: Hex): Promise<IdentityRecord | null>;\n  register(input: RegisterAgentInput): Promise<RegisterAgentResult>;\n  update(input: UpdateAgentInput): Promise<UpdateAgentResult>;\n  toRegistrationEntry(\n    record: IdentityRecord,\n    signature?: string\n  ): RegistrationEntry;\n};\n\nexport type PublicClientLike = {\n  readContract(args: {\n    address: Hex;\n    abi: typeof IDENTITY_REGISTRY_ABI;\n    functionName: IdentityRegistryReadFunctionName;\n    args?: readonly unknown[];\n  }): Promise<any>;\n};\n\nexport type WalletClientLike = {\n  account?: { address?: Hex };\n  writeContract(args: {\n    address: Hex;\n    abi: typeof IDENTITY_REGISTRY_ABI;\n    functionName: IdentityRegistryWriteFunctionName;\n    args?: readonly unknown[];\n  }): Promise<Hex>;\n};\n\ntype IdentityRegistryReadFunctionName =\n  | \"Get\"\n  | \"ResolveByDomain\"\n  | \"ResolveByAddress\";\n\ntype IdentityRegistryWriteFunctionName = \"New\" | \"Update\";\n\nexport type RegisterAgentInput = {\n  domain: string;\n  agentAddress?: Hex;\n};\n\nexport type RegisterAgentResult = {\n  transactionHash: Hex;\n  agentAddress: Hex;\n  agentId?: bigint;\n};\n\nexport type UpdateAgentInput = {\n  agentId: bigint | number | string;\n  domain?: string;\n  agentAddress?: Hex;\n};\n\nexport type UpdateAgentResult = {\n  transactionHash: Hex;\n  agentId?: bigint;\n};\n\nexport const IDENTITY_REGISTRY_ABI = [\n  {\n    type: \"function\",\n    name: \"New\",\n    stateMutability: \"nonpayable\",\n    inputs: [\n      { name: \"agentDomain\", type: \"string\" },\n      { name: \"agentAddress\", type: \"address\" },\n    ],\n    outputs: [{ name: \"agentId\", type: \"uint256\" }],\n  },\n  {\n    type: \"function\",\n    name: \"Update\",\n    stateMutability: \"nonpayable\",\n    inputs: [\n      { name: \"agentId\", type: \"uint256\" },\n      { name: \"agentDomain\", type: \"string\" },\n      { name: \"agentAddress\", type: \"address\" },\n    ],\n    outputs: [{ name: \"ok\", type: \"bool\" }],\n  },\n  {\n    type: \"function\",\n    name: \"Get\",\n    stateMutability: \"view\",\n    inputs: [{ name: \"agentId\", type: \"uint256\" }],\n    outputs: [\n      { name: \"agentId\", type: \"uint256\" },\n      { name: \"agentDomain\", type: \"string\" },\n      { name: \"agentAddress\", type: \"address\" },\n    ],\n  },\n  {\n    type: \"function\",\n    name: \"ResolveByDomain\",\n    stateMutability: \"view\",\n    inputs: [{ name: \"agentDomain\", type: \"string\" }],\n    outputs: [\n      { name: \"agentId\", type: \"uint256\" },\n      { name: \"agentDomain\", type: \"string\" },\n      { name: \"agentAddress\", type: \"address\" },\n    ],\n  },\n  {\n    type: \"function\",\n    name: \"ResolveByAddress\",\n    stateMutability: \"view\",\n    inputs: [{ name: \"agentAddress\", type: \"address\" }],\n    outputs: [\n      { name: \"agentId\", type: \"uint256\" },\n      { name: \"agentDomain\", type: \"string\" },\n      { name: \"agentAddress\", type: \"address\" },\n    ],\n  },\n] as const;\n\nexport function createIdentityRegistryClient<\n  PublicClient extends PublicClientLike,\n  WalletClient extends WalletClientLike | undefined = undefined,\n>(\n  options: IdentityRegistryClientOptions<PublicClient, WalletClient>\n): IdentityRegistryClient {\n  const {\n    address,\n    chainId,\n    publicClient,\n    walletClient,\n    namespace = \"eip155\",\n  } = options;\n\n  function ensureWalletClient(): WalletClientLike {\n    if (!walletClient) {\n      throw new Error(\n        \"identity registry client requires walletClient for writes\"\n      );\n    }\n    return walletClient;\n  }\n\n  async function readRecord(\n    fn: IdentityRegistryReadFunctionName,\n    args: readonly unknown[]\n  ): Promise<IdentityRecord | null> {\n    const result = (await publicClient.readContract({\n      address,\n      abi: IDENTITY_REGISTRY_ABI,\n      functionName: fn,\n      args,\n    })) as readonly [bigint, string, string];\n\n    if (!result) return null;\n\n    const [agentId, agentDomain, agentAddress] = result;\n    if (!agentDomain && (!agentAddress || agentAddress === ZERO_ADDRESS)) {\n      return null;\n    }\n\n    return {\n      agentId,\n      agentDomain,\n      agentAddress: normalizeAddress(agentAddress),\n    };\n  }\n\n  return {\n    address,\n    chainId,\n    async get(agentId) {\n      const id = BigInt(agentId);\n      return readRecord(\"Get\", [id]);\n    },\n    resolveByDomain(domain) {\n      const normalized = normalizeDomain(domain);\n      return readRecord(\"ResolveByDomain\", [normalized]);\n    },\n    resolveByAddress(rawAddress) {\n      const normalized = normalizeAddress(rawAddress);\n      return readRecord(\"ResolveByAddress\", [normalized]);\n    },\n    async register(input) {\n      const wallet = ensureWalletClient();\n      const normalizedDomain = normalizeDomain(input.domain);\n      const normalizedAddress = normalizeAddress(\n        input.agentAddress ?? wallet.account?.address ?? ZERO_ADDRESS\n      );\n\n      if (!normalizedDomain) {\n        throw new Error(\"agent domain is required\");\n      }\n      if (!normalizedAddress || normalizedAddress === ZERO_ADDRESS) {\n        throw new Error(\"agent address is required\");\n      }\n\n      const txHash = await wallet.writeContract({\n        address,\n        abi: IDENTITY_REGISTRY_ABI,\n        functionName: \"New\",\n        args: [normalizedDomain, normalizedAddress],\n      });\n\n      let agentId: bigint | undefined;\n      try {\n        const record = await readRecord(\"ResolveByDomain\", [normalizedDomain]);\n        agentId = record?.agentId;\n      } catch {\n        agentId = undefined;\n      }\n\n      return {\n        transactionHash: txHash,\n        agentAddress: normalizedAddress,\n        agentId,\n      };\n    },\n    async update(input) {\n      const wallet = ensureWalletClient();\n      const agentId = BigInt(input.agentId);\n      const normalizedDomain =\n        typeof input.domain === \"string\" ? normalizeDomain(input.domain) : \"\";\n      const normalizedAddress =\n        typeof input.agentAddress === \"string\"\n          ? normalizeAddress(input.agentAddress)\n          : ZERO_ADDRESS;\n\n      if (\n        !normalizedDomain &&\n        (!normalizedAddress || normalizedAddress === ZERO_ADDRESS)\n      ) {\n        throw new Error(\"update requires domain and/or agentAddress\");\n      }\n\n      const txHash = await wallet.writeContract({\n        address,\n        abi: IDENTITY_REGISTRY_ABI,\n        functionName: \"Update\",\n        args: [\n          agentId,\n          normalizedDomain,\n          normalizedAddress && normalizedAddress !== ZERO_ADDRESS\n            ? normalizedAddress\n            : ZERO_ADDRESS,\n        ],\n      });\n\n      let resultingRecord: IdentityRecord | null = null;\n      try {\n        if (normalizedDomain) {\n          resultingRecord = await readRecord(\"ResolveByDomain\", [\n            normalizedDomain,\n          ]);\n        }\n        if (!resultingRecord) {\n          resultingRecord = await readRecord(\"Get\", [agentId]);\n        }\n      } catch {\n        resultingRecord = null;\n      }\n\n      return {\n        transactionHash: txHash,\n        agentId: resultingRecord?.agentId ?? agentId,\n      };\n    },\n    toRegistrationEntry(record, signature) {\n      if (chainId == null) {\n        throw new Error(\n          \"identity registry client needs chainId to build CAIP-10 registration entries\"\n        );\n      }\n      const agentAddress = toCaip10({\n        namespace,\n        chainId,\n        address: record.agentAddress,\n      });\n      const entry: RegistrationEntry = {\n        agentId: Number(record.agentId),\n        agentAddress,\n      };\n      if (signature) {\n        entry.signature = signature;\n      }\n      return entry;\n    },\n  };\n}\n\nexport function toCaip10(params: {\n  namespace?: string;\n  chainId: number | string;\n  address: string;\n}): string {\n  const namespace = params.namespace ?? \"eip155\";\n  const chainRef =\n    typeof params.chainId === \"number\"\n      ? params.chainId.toString(10)\n      : `${params.chainId ?? \"\"}`;\n  if (!chainRef) throw new Error(\"chainId is required for CAIP-10\");\n  const address = params.address?.toLowerCase?.();\n  if (!address || !address.startsWith(\"0x\")) {\n    throw new Error(\"address must be a hex string\");\n  }\n  return `${namespace}:${chainRef}:${address}`;\n}\n\nexport type SignAgentDomainProofOptions = {\n  domain: string;\n  address: Hex;\n  chainId: number;\n  signer: MessageSignerLike;\n  nonce?: string;\n};\n\nexport type MessageSignerLike =\n  | {\n      signMessage(message: string): Promise<string>;\n    }\n  | {\n      signMessage(args: { message: string }): Promise<string>;\n    }\n  | {\n      signMessage(message: unknown): Promise<string>;\n    };\n\nexport async function signAgentDomainProof(\n  options: SignAgentDomainProofOptions\n): Promise<string> {\n  const { domain, address, chainId, nonce, signer } = options;\n  const normalizedDomain = normalizeDomain(domain);\n  if (!normalizedDomain) throw new Error(\"domain is required\");\n  const normalizedAddress = normalizeAddress(address);\n  if (!normalizedAddress || normalizedAddress === ZERO_ADDRESS) {\n    throw new Error(\"address must be a valid hex address\");\n  }\n\n  const message = buildOwnershipMessage({\n    domain: normalizedDomain,\n    address: normalizedAddress,\n    chainId,\n    nonce,\n  });\n\n  const signature = await invokeSignMessage(signer, message);\n  return signature as string;\n}\n\nexport function buildTrustConfigFromIdentity(\n  record: IdentityRecord,\n  options?: {\n    signature?: string;\n    chainId: number | string;\n    namespace?: string;\n    trustOverrides?: Partial<\n      Pick<\n        TrustConfig,\n        | \"trustModels\"\n        | \"validationRequestsUri\"\n        | \"validationResponsesUri\"\n        | \"feedbackDataUri\"\n      >\n    >;\n  }\n): TrustConfig {\n  const chainRef = options?.chainId;\n  if (chainRef == null) {\n    throw new Error(\n      \"chainId is required to generate trust config registration entry\"\n    );\n  }\n\n  const entry: RegistrationEntry = {\n    agentId: Number(record.agentId),\n    agentAddress: toCaip10({\n      namespace: options?.namespace,\n      chainId: chainRef,\n      address: record.agentAddress,\n    }),\n  };\n  if (options?.signature) entry.signature = options.signature;\n\n  return {\n    registrations: [entry],\n    ...options?.trustOverrides,\n  } satisfies TrustConfig;\n}\n\nfunction buildOwnershipMessage(params: {\n  domain: string;\n  address: Hex;\n  chainId: number;\n  nonce?: string;\n}): string {\n  const lines = [\n    \"ERC-8004 Agent Ownership Proof\",\n    `Domain: ${params.domain}`,\n    `Address: ${params.address.toLowerCase()}`,\n    `ChainId: ${params.chainId}`,\n  ];\n  if (params.nonce) {\n    lines.push(`Nonce: ${params.nonce}`);\n  }\n  return lines.join(\"\\n\");\n}\n\nasync function invokeSignMessage(\n  signer: MessageSignerLike,\n  message: string\n): Promise<string> {\n  const candidate = signer as any;\n  if (typeof candidate.signMessage !== \"function\") {\n    throw new Error(\"signer does not expose signMessage\");\n  }\n\n  try {\n    const result = await candidate.signMessage(message);\n    if (typeof result === \"string\") return result;\n  } catch (_) {\n    // fall through to try structured signature\n  }\n\n  const result = await candidate.signMessage({ message });\n  if (typeof result === \"string\") return result;\n  throw new Error(\"signMessage did not return a signature string\");\n}\n\nexport type BootstrapTrustMissingContext = {\n  client: IdentityRegistryClient;\n  normalizedDomain: string;\n};\n\nexport type BootstrapTrustOptions = {\n  domain: string;\n  chainId: number;\n  registryAddress: Hex;\n  publicClient: PublicClientLike;\n  walletClient?: WalletClientLike;\n  namespace?: string;\n  signer?: MessageSignerLike;\n  signatureNonce?: string;\n  registerIfMissing?: boolean;\n  skipRegister?: boolean;\n  trustOverrides?: Parameters<\n    typeof buildTrustConfigFromIdentity\n  >[1][\"trustOverrides\"];\n  onMissing?: (\n    context: BootstrapTrustMissingContext\n  ) =>\n    | Promise<IdentityRecord | null | undefined>\n    | IdentityRecord\n    | null\n    | undefined;\n};\n\nexport type BootstrapTrustResult = {\n  trust?: TrustConfig;\n  record?: IdentityRecord | null;\n  transactionHash?: Hex;\n  signature?: string;\n  didRegister?: boolean;\n};\n\nexport async function bootstrapTrust(\n  options: BootstrapTrustOptions\n): Promise<BootstrapTrustResult> {\n  const normalizedDomain = normalizeDomain(options.domain);\n  if (!normalizedDomain) {\n    throw new Error(\"domain is required to bootstrap trust state\");\n  }\n\n  const shouldRegister = Boolean(\n    options.registerIfMissing && !options.skipRegister\n  );\n\n  const client = createIdentityRegistryClient({\n    address: options.registryAddress,\n    chainId: options.chainId,\n    publicClient: options.publicClient,\n    walletClient: options.walletClient,\n    namespace: options.namespace,\n  });\n\n  let record = await client.resolveByDomain(normalizedDomain).catch(() => null);\n  let transactionHash: Hex | undefined;\n  let didRegister = false;\n\n  if (!record && options.onMissing) {\n    const handled = await options.onMissing({\n      client,\n      normalizedDomain,\n    });\n    if (handled) {\n      record = handled;\n    }\n  }\n\n  if (!record && shouldRegister) {\n    const registration = await client.register({ domain: normalizedDomain });\n    transactionHash = registration.transactionHash;\n    didRegister = true;\n\n    record = await client.resolveByDomain(normalizedDomain).catch(() => null);\n    if (!record && registration.agentId != null) {\n      record = {\n        agentId: registration.agentId,\n        agentDomain: normalizedDomain,\n        agentAddress: registration.agentAddress,\n      } satisfies IdentityRecord;\n    }\n  }\n\n  if (!record) {\n    return {\n      trust: undefined,\n      record: null,\n      transactionHash,\n      didRegister,\n    };\n  }\n\n  let signature: string | undefined;\n  if (options.signer) {\n    signature = await signAgentDomainProof({\n      domain: record.agentDomain,\n      address: record.agentAddress,\n      chainId: options.chainId,\n      signer: options.signer,\n      nonce: options.signatureNonce,\n    });\n  }\n\n  const trust = buildTrustConfigFromIdentity(record, {\n    chainId: options.chainId,\n    namespace: options.namespace,\n    signature,\n    trustOverrides: options.trustOverrides,\n  });\n\n  return {\n    trust,\n    record,\n    transactionHash,\n    signature,\n    didRegister,\n  } satisfies BootstrapTrustResult;\n}\n\ntype TrustOverridesInput = Parameters<\n  typeof buildTrustConfigFromIdentity\n>[1][\"trustOverrides\"];\n\nconst DEFAULT_CHAIN_ID = 84532;\nconst DEFAULT_NAMESPACE = \"eip155\";\nconst DEFAULT_TRUST_MODELS: NonNullable<TrustConfig[\"trustModels\"]> = [\n  \"feedback\",\n  \"inference-validation\",\n];\n\nconst defaultLogger = {\n  info:\n    typeof console !== \"undefined\" && typeof console.info === \"function\"\n      ? console.info.bind(console)\n      : () => {},\n  warn:\n    typeof console !== \"undefined\" && typeof console.warn === \"function\"\n      ? console.warn.bind(console)\n      : () => {},\n};\n\nfunction parsePositiveInteger(value: string | undefined): number | undefined {\n  if (!value) return undefined;\n  const parsed = Number(value);\n  if (!Number.isFinite(parsed) || parsed <= 0) return undefined;\n  return Math.trunc(parsed);\n}\n\nfunction resolveTrustOverrides(\n  domain: string | undefined,\n  overrides?: TrustOverridesInput,\n  fallback?: TrustOverridesInput\n): TrustOverridesInput | undefined {\n  const result: TrustOverridesInput = {};\n\n  if (domain) {\n    result.trustModels = DEFAULT_TRUST_MODELS;\n    const origin = domain.startsWith(\"http\") ? domain : `https://${domain}`;\n    result.validationRequestsUri = `${origin}/validation/requests.json`;\n    result.validationResponsesUri = `${origin}/validation/responses.json`;\n    result.feedbackDataUri = `${origin}/feedback.json`;\n  }\n\n  if (fallback) {\n    if (fallback.trustModels !== undefined) {\n      result.trustModels = fallback.trustModels;\n    }\n    if (fallback.validationRequestsUri !== undefined) {\n      result.validationRequestsUri = fallback.validationRequestsUri;\n    }\n    if (fallback.validationResponsesUri !== undefined) {\n      result.validationResponsesUri = fallback.validationResponsesUri;\n    }\n    if (fallback.feedbackDataUri !== undefined) {\n      result.feedbackDataUri = fallback.feedbackDataUri;\n    }\n  }\n\n  if (overrides) {\n    if (overrides.trustModels !== undefined) {\n      result.trustModels = overrides.trustModels;\n    }\n    if (overrides.validationRequestsUri !== undefined) {\n      result.validationRequestsUri = overrides.validationRequestsUri;\n    }\n    if (overrides.validationResponsesUri !== undefined) {\n      result.validationResponsesUri = overrides.validationResponsesUri;\n    }\n    if (overrides.feedbackDataUri !== undefined) {\n      result.feedbackDataUri = overrides.feedbackDataUri;\n    }\n  }\n\n  return Object.keys(result).length > 0 ? result : undefined;\n}\n\nfunction synthesizeTrustConfig(params: {\n  address: string;\n  chainId: number;\n  namespace: string;\n  fallbackAgentId?: number | string;\n  signature?: string;\n  overrides?: TrustOverridesInput;\n  warn(message: string, error?: unknown): void;\n}): (BootstrapTrustResult & { synthetic: true }) | null {\n  try {\n    const agentAddress = toCaip10({\n      chainId: params.chainId,\n      address: params.address,\n      namespace: params.namespace,\n    });\n\n    const entry: RegistrationEntry = {\n      agentId: Number(params.fallbackAgentId ?? 0),\n      agentAddress,\n    };\n    if (params.signature) {\n      entry.signature = params.signature;\n    }\n\n    const trust: TrustConfig = {\n      registrations: [entry],\n      ...params.overrides,\n    };\n\n    return {\n      trust,\n      record: undefined,\n      transactionHash: undefined,\n      signature: params.signature,\n      didRegister: undefined,\n      synthetic: true,\n    };\n  } catch (error) {\n    params.warn(\n      \"[agent-kit] unable to synthesise CAIP-10 identity entry\",\n      error\n    );\n    return null;\n  }\n}\n\ntype InferLogger = {\n  info?(message: string): void;\n  warn?(message: string, error?: unknown): void;\n};\n\nexport type BootstrapIdentityClients = {\n  publicClient: PublicClientLike;\n  walletClient?: WalletClientLike;\n  signer?: MessageSignerLike;\n};\n\nexport type BootstrapIdentityClientFactory = (params: {\n  chainId: number;\n  rpcUrl: string;\n  env: Record<string, string | undefined>;\n}) =>\n  | BootstrapIdentityClients\n  | null\n  | undefined\n  | Promise<BootstrapIdentityClients | null | undefined>;\n\nexport type BootstrapIdentityOptions = {\n  domain?: string;\n  chainId?: number;\n  registryAddress?: Hex;\n  namespace?: string;\n  publicClient?: PublicClientLike;\n  walletClient?: WalletClientLike;\n  signer?: MessageSignerLike;\n  rpcUrl?: string;\n  makeClients?: BootstrapIdentityClientFactory;\n  registerIfMissing?: boolean;\n  skipRegister?: boolean;\n  signatureNonce?: string;\n  trustOverrides?: TrustOverridesInput;\n  fallback?: {\n    address?: string;\n    agentId?: number | string;\n    namespace?: string;\n    signature?: string;\n    trustModels?: TrustConfig[\"trustModels\"];\n    validationRequestsUri?: string;\n    validationResponsesUri?: string;\n    feedbackDataUri?: string;\n  };\n  env?: Record<string, string | undefined>;\n  logger?: InferLogger;\n};\n\nexport type BootstrapIdentityResult = BootstrapTrustResult & {\n  synthetic?: boolean;\n};\n\nexport async function bootstrapIdentity(\n  options: BootstrapIdentityOptions = {}\n): Promise<BootstrapIdentityResult> {\n  const env =\n    options.env ??\n    (typeof process !== \"undefined\" && typeof process.env === \"object\"\n      ? (process.env as Record<string, string | undefined>)\n      : {});\n\n  const logger = {\n    info: options.logger?.info ?? defaultLogger.info,\n    warn: options.logger?.warn ?? defaultLogger.warn,\n  } satisfies InferLogger;\n\n  const resolvedChainId =\n    options.chainId ?? parsePositiveInteger(env.CHAIN_ID) ?? DEFAULT_CHAIN_ID;\n\n  const domain = options.domain ?? env.AGENT_DOMAIN;\n  const namespace =\n    options.namespace ?? options.fallback?.namespace ?? DEFAULT_NAMESPACE;\n  const registryAddress =\n    options.registryAddress ??\n    (env.IDENTITY_REGISTRY_ADDRESS as Hex | undefined);\n  const rpcUrl = options.rpcUrl ?? env.RPC_URL;\n\n  let publicClient = options.publicClient;\n  let walletClient = options.walletClient;\n  let signer = options.signer;\n\n  if (!publicClient && options.makeClients && rpcUrl) {\n    const produced = await options.makeClients({\n      chainId: resolvedChainId,\n      rpcUrl,\n      env,\n    });\n    if (produced?.publicClient) {\n      publicClient = produced.publicClient;\n      walletClient = walletClient ?? produced.walletClient;\n      signer = signer ?? produced.signer ?? (produced.walletClient as any);\n    }\n  }\n\n  if (!signer && walletClient) {\n    signer = walletClient as any;\n  }\n\n  const fallbackOverrides = resolveTrustOverrides(domain, undefined, {\n    trustModels:\n      options.fallback?.trustModels ??\n      (domain ? undefined : DEFAULT_TRUST_MODELS),\n    validationRequestsUri: options.fallback?.validationRequestsUri,\n    validationResponsesUri: options.fallback?.validationResponsesUri,\n    feedbackDataUri: options.fallback?.feedbackDataUri,\n  });\n\n  const resolvedOverrides = resolveTrustOverrides(\n    domain,\n    options.trustOverrides,\n    fallbackOverrides\n  );\n\n  if (domain && registryAddress && publicClient) {\n    try {\n      const result = await bootstrapTrust({\n        domain,\n        chainId: resolvedChainId,\n        registryAddress,\n        namespace,\n        publicClient,\n        walletClient,\n        signer,\n        signatureNonce: options.signatureNonce ?? env.IDENTITY_SIGNATURE_NONCE,\n        registerIfMissing:\n          options.registerIfMissing ?? env.REGISTER_IDENTITY === \"true\",\n        skipRegister: options.skipRegister,\n        trustOverrides: resolvedOverrides,\n      });\n\n      if (result.trust) {\n        return result;\n      }\n\n      logger.warn(\n        \"[agent-kit] identity not found in registry; falling back to synthetic trust\"\n      );\n    } catch (error) {\n      logger.warn(\n        \"[agent-kit] failed to bootstrap ERC-8004 trust; falling back to synthetic trust\",\n        error\n      );\n    }\n  }\n\n  const fallbackAddress = options.fallback?.address ?? env.ADDRESS;\n  if (!fallbackAddress) {\n    logger.warn(\n      \"[agent-kit] unable to resolve fallback identity address; skipping trust metadata\"\n    );\n    return {};\n  }\n\n  const fallbackSignature =\n    options.fallback?.signature ??\n    env.IDENTITY_FALLBACK_SIGNATURE ??\n    \"0xdeadbeef\";\n\n  const synthetic = synthesizeTrustConfig({\n    address: fallbackAddress,\n    chainId: resolvedChainId,\n    namespace,\n    fallbackAgentId: options.fallback?.agentId,\n    signature: fallbackSignature,\n    overrides: resolvedOverrides,\n    warn: logger.warn,\n  });\n\n  if (synthetic) {\n    return synthetic;\n  }\n\n  return {};\n}\n\nexport type MakeViemClientsFromEnvOptions = {\n  env?: Record<string, string | undefined>;\n  rpcUrl?: string;\n  privateKey?: `0x${string}` | string;\n};\n\nasync function importViemModules(): Promise<{\n  createPublicClient: (...args: any[]) => any;\n  createWalletClient: (...args: any[]) => any;\n  http: (url: string) => any;\n  privateKeyToAccount: (key: `0x${string}`) => any;\n  baseSepolia: { id: number } & Record<string, unknown>;\n} | null> {\n  try {\n    const viem = await import(\"viem\");\n    const accounts = await import(\"viem/accounts\");\n    const chains = await import(\"viem/chains\").catch(() => ({}));\n    const baseSepoliaChain =\n      (chains as any).baseSepolia ?? ({ id: DEFAULT_CHAIN_ID } as const);\n    return {\n      createPublicClient: (viem as any).createPublicClient,\n      createWalletClient: (viem as any).createWalletClient,\n      http: (viem as any).http,\n      privateKeyToAccount: (accounts as any).privateKeyToAccount,\n      baseSepolia: baseSepoliaChain,\n    };\n  } catch (error) {\n    defaultLogger.warn(\n      \"[agent-kit] viem helpers unavailable; install viem to use makeViemClientsFromEnv\",\n      error\n    );\n    return null;\n  }\n}\n\nfunction resolveEnvObject(\n  env?: Record<string, string | undefined>\n): Record<string, string | undefined> {\n  if (env) return env;\n  if (typeof process !== \"undefined\" && typeof process.env === \"object\") {\n    return process.env as Record<string, string | undefined>;\n  }\n  return {};\n}\n\nexport async function makeViemClientsFromEnv(\n  options: MakeViemClientsFromEnvOptions = {}\n): Promise<BootstrapIdentityClientFactory | undefined> {\n  const env = resolveEnvObject(options.env);\n  const modules = await importViemModules();\n  if (!modules) return undefined;\n\n  return ({ chainId, rpcUrl, env: runtimeEnv }) => {\n    const effectiveRpcUrl = options.rpcUrl ?? rpcUrl ?? env.RPC_URL;\n    if (!effectiveRpcUrl) {\n      defaultLogger.warn(\n        \"[agent-kit] RPC_URL missing for viem client factory; skipping\"\n      );\n      return null;\n    }\n\n    const transport = modules.http(effectiveRpcUrl);\n    const chain = { ...modules.baseSepolia, id: chainId };\n    const publicClient = modules.createPublicClient({ chain, transport });\n\n    const mergedEnv = {\n      ...env,\n      ...runtimeEnv,\n    };\n    const privateKey = (options.privateKey ?? mergedEnv.PRIVATE_KEY) as\n      | `0x${string}`\n      | undefined;\n\n    let walletClient: any = undefined;\n    if (privateKey) {\n      try {\n        const account = modules.privateKeyToAccount(\n          privateKey as `0x${string}`\n        );\n        walletClient = modules.createWalletClient({\n          chain,\n          account,\n          transport,\n        });\n      } catch (error) {\n        defaultLogger.warn(\n          \"[agent-kit] failed to configure viem wallet client from PRIVATE_KEY\",\n          error\n        );\n      }\n    }\n\n    return {\n      publicClient,\n      walletClient,\n      signer: walletClient,\n    } satisfies BootstrapIdentityClients;\n  };\n}\n","import type {\n  AgentWalletSendTransactionRequest,\n  AgentWalletSendTransactionResponse,\n  AgentWalletSignTransactionRequest,\n  AgentWalletSignTransactionResponse,\n  AgentWalletSignMessageRequest,\n  AgentWalletSignMessageResponse,\n  AgentWalletSignTypedDataRequest,\n  AgentWalletSignTypedDataResponse,\n} from \"@lucid-dreams/client\";\nimport { wrapFetchWithPayment, createSigner } from \"x402-fetch\";\nimport type { Hex } from \"x402-fetch\";\nimport type { Signer } from \"x402/types\";\nimport { sanitizeAddress } from \"./utils\";\nimport { getAgentKitConfig } from \"./config\";\n\ntype FetchLike = typeof fetch;\n\nexport type AgentWalletClientOptions = {\n  agentRef: string;\n  baseUrl?: string;\n  fetch?: FetchLike;\n  getAuthHeaders?: () =>\n    | Record<string, string>\n    | Promise<Record<string, string>>;\n};\n\nexport type AgentWalletClient = {\n  sendTransaction(\n    body: AgentWalletSendTransactionRequest\n  ): Promise<AgentWalletSendTransactionResponse>;\n  signTransaction(\n    body: AgentWalletSignTransactionRequest\n  ): Promise<AgentWalletSignTransactionResponse>;\n  signMessage(\n    body: AgentWalletSignMessageRequest\n  ): Promise<AgentWalletSignMessageResponse>;\n  signTypedData(\n    body: AgentWalletSignTypedDataRequest\n  ): Promise<AgentWalletSignTypedDataResponse>;\n};\n\nasync function toAuthHeaders(\n  getAuthHeaders?: AgentWalletClientOptions[\"getAuthHeaders\"]\n): Promise<Record<string, string>> {\n  if (!getAuthHeaders) return {};\n  const headers = await getAuthHeaders();\n  return headers ?? {};\n}\n\nfunction normalizeBaseUrl(baseUrl: string): string {\n  return baseUrl.endsWith(\"/\") ? baseUrl.slice(0, -1) : baseUrl;\n}\n\nfunction buildUrl(baseUrl: string, agentRef: string, path: string): string {\n  const normalizedBase = normalizeBaseUrl(baseUrl);\n  const encodedRef = encodeURIComponent(agentRef);\n  return `${normalizedBase}/v1/agents/${encodedRef}${path}`;\n}\n\nasync function parseResponse<T>(response: Response): Promise<T> {\n  if (response.ok) {\n    return (await response.json()) as T;\n  }\n\n  let payload: any = null;\n  try {\n    payload = await response.json();\n  } catch {\n    // ignore JSON parse errors\n  }\n\n  const message =\n    payload?.message ||\n    payload?.error ||\n    `Wallet request failed (${response.status})`;\n  const error = new Error(String(message));\n  (error as any).status = response.status;\n  (error as any).details = payload;\n  throw error;\n}\n\nexport function createAgentWalletClient(\n  options: AgentWalletClientOptions\n): AgentWalletClient {\n  const { wallet } = getAgentKitConfig();\n  const resolvedBase =\n    options.baseUrl && options.baseUrl.trim().length > 0\n      ? options.baseUrl\n      : wallet.apiBaseUrl;\n  const baseUrl = normalizeBaseUrl(resolvedBase);\n  const fetchImpl: FetchLike = options.fetch ?? fetch;\n\n  async function postJson<T>(path: string, body: unknown): Promise<T> {\n    const url = buildUrl(baseUrl, options.agentRef, path);\n    const headers: Record<string, string> = {\n      \"content-type\": \"application/json\",\n      ...((await toAuthHeaders(options.getAuthHeaders)) || {}),\n    };\n\n    const response = await fetchImpl(url, {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify(body),\n      credentials: \"include\",\n    });\n\n    return parseResponse<T>(response);\n  }\n\n  return {\n    sendTransaction(body) {\n      return postJson<AgentWalletSendTransactionResponse>(\n        \"/wallet/send-transaction\",\n        body\n      );\n    },\n    signTransaction(body) {\n      return postJson<AgentWalletSignTransactionResponse>(\n        \"/wallet/sign-transaction\",\n        body\n      );\n    },\n    signMessage(body) {\n      return postJson<AgentWalletSignMessageResponse>(\n        \"/wallet/sign-message\",\n        body\n      );\n    },\n    signTypedData(body) {\n      return postJson<AgentWalletSignTypedDataResponse>(\n        \"/wallet/sign-typed-data\",\n        body\n      );\n    },\n  };\n}\n\nexport type AgentWalletClientFactory = typeof createAgentWalletClient;\n\ntype TypedDataPayload = {\n  domain?: Record<string, unknown>;\n  types?: Record<string, Array<{ name: string; type: string }>>;\n  message?: Record<string, unknown>;\n  primaryType?: string;\n  primary_type?: string;\n};\n\ntype AgentWalletSigner = {\n  chain: { id: number };\n  account: { address: `0x${string}` };\n  transport: { type: string };\n  signTypedData(payload: TypedDataPayload): Promise<`0x${string}`>;\n  signMessage(message: unknown): Promise<`0x${string}`>;\n};\n\ntype AgentPaymentLogger = {\n  warn?: (message: string, ...args: unknown[]) => void;\n};\n\nfunction attachPreconnect(\n  fetchImpl: typeof fetch,\n  baseFetch: typeof fetch\n): typeof fetch {\n  const upstream = baseFetch as typeof fetch & {\n    preconnect?: (input: string | URL, opts?: any) => Promise<void>;\n  };\n  const fallbackPreconnect = async () => {};\n  const preconnectFn =\n    typeof upstream.preconnect === \"function\"\n      ? upstream.preconnect.bind(baseFetch)\n      : fallbackPreconnect;\n  (\n    fetchImpl as typeof fetch & {\n      preconnect: typeof preconnectFn;\n    }\n  ).preconnect = preconnectFn;\n  return fetchImpl;\n}\n\nexport type AgentPaymentContext = {\n  walletClient: AgentWalletClient | null;\n  signer: AgentWalletSigner | Signer | null;\n  fetchWithPayment: typeof fetch | null;\n};\n\nexport type AgentPaymentContextOptions = {\n  agentRef: string;\n  baseUrl?: string;\n  network?: string;\n  chainId?: number;\n  maxPaymentBaseUnits?: bigint;\n  privateKey?: Hex | string;\n  getAuthHeaders?: AgentWalletClientOptions[\"getAuthHeaders\"];\n  fetch?: typeof fetch;\n  apiFetch?: typeof fetch;\n  walletClientFactory?: AgentWalletClientFactory;\n  logger?: AgentPaymentLogger;\n};\n\nfunction logWarning(\n  logger: AgentPaymentLogger | undefined,\n  message: string,\n  ...args: unknown[]\n) {\n  if (logger?.warn) {\n    logger.warn(message, ...args);\n  } else {\n    // eslint-disable-next-line no-console\n    console.warn(message, ...args);\n  }\n}\n\nfunction inferChainId(network?: string): number | undefined {\n  if (!network) return undefined;\n  const normalized = network.toLowerCase();\n  if (normalized === \"base\" || normalized === \"eip155:8453\") return 8453;\n  if (\n    normalized === \"base-sepolia\" ||\n    normalized === \"eip155:84532\" ||\n    normalized === \"base_testnet\"\n  )\n    return 84532;\n  return undefined;\n}\n\nfunction resolveMaxPaymentBaseUnits(override?: bigint): bigint | undefined {\n  if (typeof override === \"bigint\") return override;\n  const { wallet } = getAgentKitConfig();\n  if (typeof wallet.maxPaymentBaseUnits === \"bigint\") {\n    return wallet.maxPaymentBaseUnits;\n  }\n  if (typeof wallet.maxPaymentUsd === \"number\") {\n    return BigInt(Math.floor(wallet.maxPaymentUsd * 1_000_000));\n  }\n  return undefined;\n}\n\nfunction normalizeTypedData(input: TypedDataPayload) {\n  const primaryType = input.primary_type ?? input.primaryType;\n  if (!primaryType) {\n    throw new Error(\"Typed data missing primaryType\");\n  }\n  return {\n    domain: input.domain ?? {},\n    types: input.types ?? {},\n    message: input.message ?? {},\n    primary_type: primaryType,\n  };\n}\n\nasync function fetchAgentWalletAddress(\n  baseUrl: string,\n  agentRef: string,\n  headers: Record<string, string>,\n  fetchImpl: typeof fetch\n): Promise<string | null> {\n  try {\n    const url = buildUrl(baseUrl, agentRef, \"\");\n    const requestHeaders: Record<string, string> = {\n      accept: \"application/json\",\n      ...headers,\n    };\n    const hasCookie = Boolean(requestHeaders.Cookie || requestHeaders.cookie);\n    const response = await fetchImpl(url, {\n      method: \"GET\",\n      headers: requestHeaders,\n      credentials: hasCookie ? \"include\" : undefined,\n    });\n    if (!response.ok) return null;\n    const body = (await response.json().catch(() => null)) as any;\n    return body?.billing?.wallet?.address ?? null;\n  } catch {\n    return null;\n  }\n}\n\nfunction createAgentEvmSigner(opts: {\n  walletClient: AgentWalletClient;\n  initialAddress?: string | null;\n  chainId: number;\n}): AgentWalletSigner {\n  let currentAddress = sanitizeAddress(opts.initialAddress);\n  let currentChainId = opts.chainId;\n\n  const signer: AgentWalletSigner = {\n    chain: { id: currentChainId },\n    transport: { type: \"agent-wallet\" },\n    account: { address: currentAddress },\n    async signTypedData(data: TypedDataPayload) {\n      const typedData = normalizeTypedData(data);\n      const domainChain =\n        (typedData.domain as any)?.chainId ??\n        (typedData.domain as any)?.chain_id;\n      if (typeof domainChain !== \"undefined\") {\n        const parsed = Number(domainChain);\n        if (Number.isFinite(parsed) && parsed > 0) {\n          currentChainId = parsed;\n          signer.chain.id = parsed;\n        }\n      }\n      const res = await opts.walletClient.signTypedData({\n        typed_data: typedData as any,\n        idempotency_key: crypto.randomUUID(),\n      });\n      if (res?.wallet?.address) {\n        currentAddress = sanitizeAddress(res.wallet.address);\n        signer.account.address = currentAddress;\n      }\n      return res.signed.signature as `0x${string}`;\n    },\n    async signMessage(message: unknown) {\n      const normalizedMessage =\n        typeof message === \"string\"\n          ? message\n          : typeof (message as any)?.raw === \"string\"\n          ? (message as any).raw\n          : JSON.stringify(message ?? \"\");\n      const res = await opts.walletClient.signMessage({\n        message: normalizedMessage,\n      });\n      if (res?.wallet?.address) {\n        currentAddress = sanitizeAddress(res.wallet.address);\n        signer.account.address = currentAddress;\n      }\n      return res.signed.signature as `0x${string}`;\n    },\n  };\n\n  return signer;\n}\n\nexport async function createAgentPaymentContext(\n  options: AgentPaymentContextOptions\n): Promise<AgentPaymentContext> {\n  const { wallet } = getAgentKitConfig();\n  const resolvedBase =\n    options.baseUrl && options.baseUrl.trim().length > 0\n      ? options.baseUrl\n      : wallet.apiBaseUrl;\n  const baseUrl = normalizeBaseUrl(resolvedBase);\n  const upstreamFetch = options.fetch ?? fetch;\n  const apiFetch = options.apiFetch ?? upstreamFetch;\n  const maxPayment = resolveMaxPaymentBaseUnits(options.maxPaymentBaseUnits);\n\n  if (options.privateKey) {\n    try {\n      const signer = await createSigner(\n        (options.network ?? \"base-sepolia\") as any,\n        options.privateKey as any\n      );\n      const fetchWithPayment = attachPreconnect(\n        wrapFetchWithPayment(upstreamFetch, signer, maxPayment) as typeof fetch,\n        upstreamFetch\n      );\n      return {\n        walletClient: null,\n        signer,\n        fetchWithPayment,\n      };\n    } catch (error) {\n      logWarning(\n        options.logger,\n        `[agent-kit] failed to initialise paid fetch with private key: ${\n          (error as Error)?.message || error\n        }`\n      );\n      return {\n        walletClient: null,\n        signer: null,\n        fetchWithPayment: null,\n      };\n    }\n  }\n\n  const authHeaders = await toAuthHeaders(options.getAuthHeaders);\n  if (!authHeaders || Object.keys(authHeaders).length === 0) {\n    return {\n      walletClient: null,\n      signer: null,\n      fetchWithPayment: null,\n    };\n  }\n\n  const walletClientFactory =\n    options.walletClientFactory ?? createAgentWalletClient;\n\n  const walletClient = walletClientFactory({\n    agentRef: options.agentRef,\n    baseUrl,\n    getAuthHeaders: options.getAuthHeaders,\n    fetch: apiFetch,\n  });\n\n  const chainId = options.chainId ?? inferChainId(options.network);\n  if (!chainId) {\n    logWarning(\n      options.logger,\n      \"[agent-kit] unable to derive chainId for payment signer; provide options.chainId or options.network\"\n    );\n    return {\n      walletClient,\n      signer: null,\n      fetchWithPayment: null,\n    };\n  }\n\n  try {\n    const initialAddress = await fetchAgentWalletAddress(\n      baseUrl,\n      options.agentRef,\n      authHeaders,\n      apiFetch\n    );\n    const signer = createAgentEvmSigner({\n      walletClient,\n      initialAddress,\n      chainId,\n    });\n    const fetchWithPayment = attachPreconnect(\n      wrapFetchWithPayment(\n        upstreamFetch,\n        signer as unknown as Signer,\n        maxPayment\n      ) as typeof fetch,\n      upstreamFetch\n    );\n    return {\n      walletClient,\n      signer,\n      fetchWithPayment,\n    };\n  } catch (error) {\n    logWarning(\n      options.logger,\n      `[agent-kit] failed to initialise agent wallet payment signer: ${\n        (error as Error)?.message || error\n      }`\n    );\n    return {\n      walletClient,\n      signer: null,\n      fetchWithPayment: null,\n    };\n  }\n}\n\nexport type BootstrapAgentPaymentContextOptions = {\n  env?: Record<string, string | undefined>;\n  agentRef?: string;\n  fetch?: typeof fetch;\n  apiFetch?: typeof fetch;\n  walletClientFactory?: AgentWalletClientFactory;\n  getAuthHeaders?: AgentWalletClientOptions[\"getAuthHeaders\"];\n  logger?: AgentPaymentLogger;\n};\n\nfunction resolveProcessEnv(): Record<string, string | undefined> {\n  if (typeof process !== \"undefined\" && typeof process.env === \"object\") {\n    return process.env as Record<string, string | undefined>;\n  }\n  return {};\n}\n\nfunction toBearerToken(token: string | undefined): string | undefined {\n  if (!token) return undefined;\n  const trimmed = token.trim();\n  if (!trimmed) return undefined;\n  return trimmed.startsWith(\"Bearer \") ? trimmed : `Bearer ${trimmed}`;\n}\n\nexport async function bootstrapAgentPaymentContext(\n  options: BootstrapAgentPaymentContextOptions = {}\n): Promise<AgentPaymentContext | null> {\n  const env = options.env ?? resolveProcessEnv();\n  const agentRef = options.agentRef ?? env.AGENT_REF;\n  if (!agentRef) {\n    logWarning(\n      options.logger,\n      \"[agent-kit] AGENT_REF missing; skipping payment bootstrap\"\n    );\n    return null;\n  }\n\n  const authHeaders =\n    options.getAuthHeaders ??\n    (async () => {\n      const token = toBearerToken(env.AGENT_AUTH_TOKEN);\n      if (!token) return {};\n      return { Authorization: token };\n    });\n\n  try {\n    const { payments } = getAgentKitConfig();\n    const context = await createAgentPaymentContext({\n      agentRef,\n      network: payments.network,\n      getAuthHeaders: authHeaders,\n      fetch: options.fetch,\n      apiFetch: options.apiFetch,\n      walletClientFactory: options.walletClientFactory,\n      logger: options.logger,\n    });\n\n    if (!context.fetchWithPayment && !context.walletClient && !context.signer) {\n      return null;\n    }\n\n    return context;\n  } catch (error) {\n    logWarning(\n      options.logger,\n      `[agent-kit] failed to bootstrap payment context: ${\n        (error as Error)?.message || error\n      }`\n    );\n    return null;\n  }\n}\n","import type { EntrypointDef, PaymentsConfig } from \"./types\";\n\nexport function resolveEntrypointPrice(\n  entrypoint: EntrypointDef,\n  payments: PaymentsConfig | undefined,\n  which: \"invoke\" | \"stream\"\n): string | undefined {\n  if (typeof entrypoint.price === \"string\") return entrypoint.price;\n  if (typeof entrypoint.price === \"object\" && entrypoint.price) {\n    const value = entrypoint.price[which];\n    if (value) return value;\n  }\n  return payments?.defaultPrice;\n}\n","import { paymentMiddleware } from \"x402-hono\";\nimport { facilitator as coinbaseFacilitator } from \"@coinbase/x402\";\nimport type { EntrypointDef, PaymentsConfig } from \"./types\";\nimport { resolveEntrypointPrice } from \"./pricing\";\n\ntype PaymentMiddlewareFactory = typeof paymentMiddleware;\n\nexport type WithPaymentsParams = {\n  app: { use: (path: string, ...handlers: unknown[]) => void };\n  path: string;\n  entrypoint: EntrypointDef;\n  kind: \"invoke\" | \"stream\";\n  payments?: PaymentsConfig;\n  facilitator?: typeof coinbaseFacilitator;\n  middlewareFactory?: PaymentMiddlewareFactory;\n};\n\nexport function withPayments({\n  app,\n  path,\n  entrypoint,\n  kind,\n  payments,\n  facilitator = coinbaseFacilitator,\n  middlewareFactory = paymentMiddleware,\n}: WithPaymentsParams): boolean {\n  if (!payments) return false;\n  const network = entrypoint.network ?? payments.network;\n  if (!network) return false;\n  const price = resolveEntrypointPrice(entrypoint, payments, kind);\n  if (!price) return false;\n  app.use(\n    path,\n    middlewareFactory(\n      payments.payTo,\n      { [path]: { price, network } },\n      facilitator\n    )\n  );\n  return true;\n}\n","import { AP2_EXTENSION_URI } from \"./ap2\";\nimport type {\n  AgentCardWithEntrypoints,\n  AgentCapabilities,\n  AgentMeta,\n  AP2Config,\n  EntrypointDef,\n  Manifest,\n  PaymentMethod,\n  PaymentsConfig,\n  TrustConfig,\n} from \"./types\";\nimport type { AP2Role, AP2ExtensionDescriptor } from \"./ap2\";\nimport { toJsonSchemaOrUndefined } from \"./utils\";\nimport { resolveEntrypointPrice } from \"./pricing\";\n\nexport function buildManifest({\n  meta,\n  registry,\n  origin,\n  payments,\n  ap2,\n  trust,\n}: {\n  meta: AgentMeta;\n  registry: Iterable<EntrypointDef>;\n  origin: string;\n  payments?: PaymentsConfig;\n  ap2?: AP2Config;\n  trust?: TrustConfig;\n}): AgentCardWithEntrypoints {\n  const entrypoints: Manifest[\"entrypoints\"] = {};\n  const entrypointList = Array.from(registry);\n  const anyStreaming = entrypointList.some((e) => Boolean(e.stream));\n\n  for (const e of entrypointList) {\n    const manifestEntry: Manifest[\"entrypoints\"][string] = {\n      description: e.description,\n      streaming: Boolean(e.stream),\n      input_schema: toJsonSchemaOrUndefined(e.input),\n      output_schema: toJsonSchemaOrUndefined(e.output),\n    };\n    const invP = resolveEntrypointPrice(e, payments, \"invoke\");\n    const strP = e.stream\n      ? resolveEntrypointPrice(e, payments, \"stream\")\n      : undefined;\n    if (invP || strP) {\n      const pricing: NonNullable<typeof manifestEntry.pricing> = {};\n      if (invP) pricing.invoke = invP;\n      if (strP) pricing.stream = strP;\n      manifestEntry.pricing = pricing;\n    }\n    entrypoints[e.key] = manifestEntry;\n  }\n\n  const defaultInputModes = [\"application/json\"];\n  const defaultOutputModes = [\"application/json\", \"text/plain\"];\n  const skills = entrypointList.map((e) => ({\n    id: e.key,\n    name: e.key,\n    description: e.description,\n    inputModes: defaultInputModes,\n    outputModes: defaultOutputModes,\n    streaming: Boolean(e.stream),\n    x_input_schema: toJsonSchemaOrUndefined(e.input),\n    x_output_schema: toJsonSchemaOrUndefined(e.output),\n  }));\n\n  const capabilities: AgentCapabilities = {\n    streaming: anyStreaming,\n    pushNotifications: false,\n    stateTransitionHistory: true,\n  };\n\n  const resolvedAp2Config: AP2Config | undefined =\n    ap2 ?? (payments ? { roles: [\"merchant\"], required: true } : undefined);\n  if (resolvedAp2Config?.roles?.length) {\n    const [firstRole, ...restRoles] = resolvedAp2Config.roles;\n    if (!firstRole) {\n      throw new Error(\"AP2 roles must contain at least one entry\");\n    }\n    const roles: [AP2Role, ...AP2Role[]] = [firstRole, ...restRoles];\n    const extension: AP2ExtensionDescriptor = {\n      uri: AP2_EXTENSION_URI,\n      description:\n        resolvedAp2Config.description ?? \"Agent Payments Protocol (AP2)\",\n      required: resolvedAp2Config.required ?? roles.includes(\"merchant\"),\n      params: { roles },\n    };\n    const existing = capabilities.extensions ?? [];\n    const withoutAp2 = existing.filter(\n      (ext) => !(\"uri\" in ext && ext.uri === AP2_EXTENSION_URI)\n    );\n    capabilities.extensions = [...withoutAp2, extension];\n  }\n\n  const card: AgentCardWithEntrypoints = {\n    name: meta.name,\n    description: meta.description,\n    url: origin.endsWith(\"/\") ? origin : `${origin}/`,\n    version: meta.version,\n    provider: undefined,\n    capabilities,\n    defaultInputModes,\n    defaultOutputModes,\n    skills,\n    supportsAuthenticatedExtendedCard: false,\n    entrypoints,\n  };\n\n  if (payments) {\n    const pm = payments;\n    const paymentMethod: PaymentMethod = {\n      method: \"x402\",\n      payee: pm.payTo,\n      network: pm.network,\n      endpoint: pm.facilitatorUrl,\n      priceModel: pm.defaultPrice ? { default: pm.defaultPrice } : undefined,\n      extensions: {\n        x402: { facilitatorUrl: pm.facilitatorUrl },\n      },\n    };\n    card.payments = [paymentMethod];\n  }\n\n  if (trust) {\n    if (trust.registrations?.length) {\n      card.registrations = trust.registrations;\n    }\n    if (trust.trustModels?.length) {\n      const unique = Array.from(new Set(trust.trustModels));\n      card.trustModels = unique;\n    }\n    if (trust.validationRequestsUri) {\n      card.ValidationRequestsURI = trust.validationRequestsUri;\n    }\n    if (trust.validationResponsesUri) {\n      card.ValidationResponsesURI = trust.validationResponsesUri;\n    }\n    if (trust.feedbackDataUri) {\n      card.FeedbackDataURI = trust.feedbackDataUri;\n    }\n  }\n\n  return card;\n}\n","import { Hono } from \"hono\";\nimport { streamSSE } from \"hono/streaming\";\nimport type {\n  AgentMeta,\n  AP2Config,\n  EntrypointDef,\n  PaymentsConfig,\n  StreamEnvelope,\n  StreamPushEnvelope,\n  StreamResult,\n  TrustConfig,\n} from \"./types\";\nimport type { AgentKitConfig, ResolvedAgentKitConfig } from \"./config\";\nimport { buildManifest } from \"./manifest\";\nimport { withPayments } from \"./paywall\";\nimport { configureAgentKit, getAgentKitConfig } from \"./config\";\nimport { html } from \"hono/html\";\n\nexport type CreateAgentAppOptions = {\n  payments?: PaymentsConfig | false;\n  ap2?: AP2Config;\n  trust?: TrustConfig;\n  entrypoints?: Iterable<EntrypointDef>;\n  config?: AgentKitConfig;\n  useConfigPayments?: boolean;\n};\n\nexport function createAgentApp(meta: AgentMeta, opts?: CreateAgentAppOptions) {\n  if (opts?.config) {\n    configureAgentKit(opts.config);\n  }\n\n  const resolvedConfig: ResolvedAgentKitConfig = getAgentKitConfig();\n\n  const paymentsOption = opts?.payments;\n  const shouldUseConfiguredPayments =\n    paymentsOption === undefined &&\n    (opts?.useConfigPayments || Boolean(opts?.config?.payments));\n\n  const resolvedPayments: PaymentsConfig | undefined =\n    paymentsOption === false\n      ? undefined\n      : (paymentsOption ??\n        (shouldUseConfiguredPayments\n          ? {\n              payTo: resolvedConfig.payments.payTo,\n              facilitatorUrl: resolvedConfig.payments.facilitatorUrl,\n              network: resolvedConfig.payments.network,\n              defaultPrice: resolvedConfig.payments.defaultPrice,\n            }\n          : undefined));\n\n  const app = new Hono();\n  const registry = new Map<string, EntrypointDef>();\n\n  const extractInput = (payload: unknown): unknown => {\n    if (payload && typeof payload === \"object\" && \"input\" in payload) {\n      const { input } = payload as { input?: unknown };\n      return input ?? {};\n    }\n    return {};\n  };\n\n  const listEntrypoints = () =>\n    Array.from(registry.values()).map((e) => ({\n      key: e.key,\n      description: e.description,\n      streaming: Boolean(e.stream),\n    }));\n\n  const buildManifestForOrigin = (origin: string) =>\n    buildManifest({\n      meta,\n      registry: registry.values(),\n      origin,\n      payments: resolvedPayments,\n      ap2: opts?.ap2,\n      trust: opts?.trust,\n    });\n\n  // Health\n  app.get(\"/health\", (c) => c.json({ ok: true, version: meta.version }));\n\n  // Introspection\n  app.get(\"/entrypoints\", (c) => c.json({ items: listEntrypoints() }));\n  app.get(\"/.well-known/agent.json\", (c) => {\n    const origin = new URL(c.req.url).origin;\n    return c.json(buildManifestForOrigin(origin));\n  });\n  // A2A preferred path alias for well-known card\n  app.get(\"/.well-known/agent-card.json\", (c) => {\n    const origin = new URL(c.req.url).origin;\n    return c.json(buildManifestForOrigin(origin));\n  });\n\n  const registerEntrypointRoutes = (ep: EntrypointDef) => {\n    const invokePath = `/entrypoints/${ep.key}/invoke` as const;\n    const streamPath = `/entrypoints/${ep.key}/stream` as const;\n\n    // x402 monetization (optional)\n    withPayments({\n      app,\n      path: invokePath,\n      entrypoint: ep,\n      kind: \"invoke\",\n      payments: resolvedPayments,\n    });\n    if (ep.stream) {\n      withPayments({\n        app,\n        path: streamPath,\n        entrypoint: ep,\n        kind: \"stream\",\n        payments: resolvedPayments,\n      });\n    }\n\n    // Invoke handler\n    app.post(invokePath, async (c) => {\n      const rawBody = await c.req.json().catch(() => undefined);\n      const input = extractInput(rawBody);\n      // Validate\n      if (ep.input) {\n        const parsed = ep.input.safeParse(input);\n        if (!parsed.success) {\n          return c.json(\n            { error: { code: \"invalid_input\", issues: parsed.error.issues } },\n            400\n          );\n        }\n      }\n      const runId = crypto.randomUUID();\n      try {\n        if (!ep.handler)\n          return c.json({ error: { code: \"not_implemented\" } }, 501);\n        const res = await ep.handler({\n          key: ep.key,\n          input,\n          signal: c.req.raw.signal,\n          headers: c.req.raw.headers,\n          runId,\n        });\n        return c.json({\n          run_id: runId,\n          status: \"succeeded\",\n          output: res.output,\n          usage: res.usage,\n          model: res.model,\n        });\n      } catch (err) {\n        return c.json(\n          {\n            error: {\n              code: \"internal_error\",\n              message: (err as Error)?.message || \"error\",\n            },\n          },\n          500\n        );\n      }\n    });\n\n    // Stream handler\n    app.post(streamPath, async (c) => {\n      if (!ep.stream)\n        return c.json(\n          { error: { code: \"stream_not_supported\", key: ep.key } },\n          400\n        );\n      const rawBody = await c.req.json().catch(() => undefined);\n      const input = extractInput(rawBody);\n      // Validate\n      if (ep.input) {\n        const parsed = ep.input.safeParse(input);\n        if (!parsed.success) {\n          return c.json(\n            { error: { code: \"invalid_input\", issues: parsed.error.issues } },\n            400\n          );\n        }\n      }\n      const runId = crypto.randomUUID();\n      let seq = 0;\n      const nowIso = () => new Date().toISOString();\n      const allocateSequence = () => seq++;\n\n      return streamSSE(\n        c,\n        async (s) => {\n          s.onAbort(() => {});\n          const sendEnvelope = async (\n            payload: StreamEnvelope | StreamPushEnvelope\n          ) => {\n            const sequence =\n              payload.sequence != null ? payload.sequence : allocateSequence();\n            const createdAt = payload.createdAt ?? nowIso();\n            const envelope = {\n              ...payload,\n              runId,\n              sequence,\n              createdAt,\n            } as StreamEnvelope;\n            await s.writeSSE({\n              event: envelope.kind,\n              data: JSON.stringify(envelope),\n              id: String(sequence),\n            });\n          };\n\n          await sendEnvelope({ kind: \"run-start\", runId });\n\n          const emit = async (chunk: StreamPushEnvelope) => {\n            await sendEnvelope(chunk);\n          };\n\n          try {\n            const res: StreamResult = await ep.stream!(\n              {\n                key: ep.key,\n                input,\n                signal: c.req.raw.signal,\n                headers: c.req.raw.headers,\n                runId,\n              },\n              emit\n            );\n\n            await sendEnvelope({\n              kind: \"run-end\",\n              runId,\n              status: res.status ?? \"succeeded\",\n              output: res.output,\n              usage: res.usage,\n              model: res.model,\n              error: res.error,\n              metadata: res.metadata,\n            });\n          } catch (err) {\n            const message = (err as Error)?.message || \"error\";\n            await sendEnvelope({\n              kind: \"error\",\n              code: \"internal_error\",\n              message,\n            });\n            await sendEnvelope({\n              kind: \"run-end\",\n              runId,\n              status: \"failed\",\n              error: { code: \"internal_error\", message },\n            });\n          }\n        },\n        async (err, s) => {\n          const message = (err as Error)?.message || \"error\";\n          const sequence = allocateSequence();\n          const createdAt = nowIso();\n          await s.writeSSE({\n            event: \"error\",\n            data: JSON.stringify({\n              kind: \"error\",\n              runId,\n              sequence,\n              createdAt,\n              code: \"stream_error\",\n              message,\n            }),\n            id: String(sequence),\n          });\n          const endSequence = allocateSequence();\n          await s.writeSSE({\n            event: \"run-end\",\n            data: JSON.stringify({\n              kind: \"run-end\",\n              runId,\n              sequence: endSequence,\n              createdAt: nowIso(),\n              status: \"failed\",\n              error: { code: \"stream_error\", message },\n            }),\n            id: String(endSequence),\n          });\n        }\n      );\n    });\n  };\n\n  const addEntrypoint = (def: EntrypointDef) => {\n    if (!def.key) throw new Error(\"entrypoint.key required\");\n    registry.set(def.key, def);\n    registerEntrypointRoutes(def);\n  };\n\n  if (opts?.entrypoints) {\n    for (const entrypoint of opts.entrypoints) {\n      addEntrypoint(entrypoint);\n    }\n  }\n\n  app.get(\"/\", (c) =>\n    c.html(\n      html`<!doctype html>\n        <html lang=\"en\">\n          <head>\n            <meta charset=\"utf-8\" />\n            <meta\n              name=\"viewport\"\n              content=\"width=device-width, initial-scale=1, shrink-to-fit=no\"\n            />\n            <title>Ax Flow Agent</title>\n            <style>\n              :root {\n                color-scheme: light dark;\n                font-family: system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\",\n                  sans-serif;\n                background-color: #0f172a;\n                color: #e2e8f0;\n              }\n              body {\n                margin: 0;\n                min-height: 100vh;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                padding: 3rem 1.5rem;\n                background: radial-gradient(circle at top, #1e293b, #0f172a);\n              }\n              .card {\n                max-width: 720px;\n                width: 100%;\n                background: rgba(15, 23, 42, 0.9);\n                border: 1px solid rgba(148, 163, 184, 0.25);\n                border-radius: 18px;\n                box-shadow: 0 24px 60px rgba(15, 23, 42, 0.4);\n                backdrop-filter: blur(14px);\n                padding: 2.5rem 2rem;\n              }\n              h1 {\n                margin: 0 0 0.75rem;\n                font-size: clamp(1.5rem, 4vw, 2.5rem);\n                letter-spacing: -0.02em;\n              }\n              p {\n                margin: 0 0 1.75rem;\n                color: rgba(226, 232, 240, 0.8);\n                line-height: 1.6;\n              }\n              pre {\n                margin: 0;\n                padding: 1.25rem;\n                background: rgba(15, 23, 42, 0.65);\n                border-radius: 12px;\n                border: 1px solid rgba(148, 163, 184, 0.2);\n                overflow-x: auto;\n                font-family: \"JetBrains Mono\", \"Fira Code\", ui-monospace,\n                  SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\",\n                  \"Courier New\", monospace;\n                font-size: 0.875rem;\n                line-height: 1.5;\n                color: #e2e8f0;\n              }\n              a {\n                color: #38bdf8;\n              }\n              .links {\n                margin-top: 1rem;\n                font-size: 0.875rem;\n                color: rgba(226, 232, 240, 0.7);\n              }\n            </style>\n          </head>\n          <body>\n            <main class=\"card\">\n              <h1>Ax Flow Agent</h1>\n              <p>\n                This example drives an AxFlow pipeline via <code>createAxLLMClient</code>.\n                The AgentCard manifest is shown below for quick inspection.\n              </p>\n              <pre id=\"agent-card\" aria-live=\"polite\">Loading agent card</pre>\n              <div class=\"links\">\n                View the JSON directly at\n                <a href=\"/.well-known/agent-card.json\">/.well-known/agent-card.json</a>.\n              </div>\n            </main>\n            <script>\n              const pre = document.getElementById(\"agent-card\");\n              fetch(\"/.well-known/agent-card.json\")\n                .then((res) => res.json())\n                .then((card) => {\n                  pre.textContent = JSON.stringify(card, null, 2);\n                })\n                .catch((error) => {\n                  console.error(\"[examples] failed to load agent card\", error);\n                  pre.textContent = \"Unable to load the agent card manifest.\";\n                });\n            </script>\n          </body>\n        </html>`\n    )\n  );\n\n  return {\n    app,\n    addEntrypoint,\n    config: resolvedConfig,\n    payments: resolvedPayments,\n  };\n}\n"]}